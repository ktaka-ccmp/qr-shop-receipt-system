# 電子領収書発行システム プロジェクト引き継ぎドキュメント

**作成日:** 2026年2月4日  
**プロジェクトオーナー:** Kimitoshi（Cluster Computing Corporation CEO）  
**目的:** Claude Codeへのプロジェクト引き継ぎ

---

## 1. プロジェクト概要

### 1.1 ワンライナー
**店舗が発行する領収書を電子化し、経費精算するビジネスパーソンに直接届けるB2B2Cプラットフォーム**

### 1.2 解決する課題

| ステークホルダー | 課題 |
|-----------------|------|
| 経費精算者 | 領収書の紛失、OCRの誤認識、電帳法対応の手間 |
| 店舗 | 印紙税コスト（5万円超で200円〜）、紙・印刷コスト |
| 経理担当者 | 領収書の突合作業、電帳法対応の運用負荷 |

### 1.3 核心的価値
- OCR不要で100%正確な構造化データ
- 電子帳簿保存法への自動対応
- 印紙税の削減（5万円超の領収書で200円→0円）
- 領収書の紛失リスク排除

---

## 2. ビジネスモデル

### 2.1 B2B2Cモデル
```
本サービス → POSベンダー → 店舗 → 利用者
  (API)        (再販)      (発行)   (受領)
```

### 2.2 料金設計

**店舗側（POSベンダー経由）:**
- 卸値: 10円/枚
- 販売価格: 15〜30円/枚（POSベンダー裁量）

**利用者側（フリーミアム）:**
| プラン | 月額 | 機能 |
|--------|------|------|
| Free | 0円 | 領収書受信・閲覧（3ヶ月保存） |
| Light | 200円 | 全期間保存、PDF出力 |
| Standard | 500円 | 仕訳CSV出力、会計ソフト連携 |

### 2.3 収益試算（1,000店舗時）
- 店舗側: 100万円/月
- 利用者側: 70万円/月
- 合計: **170万円/月**

---

## 3. 基本フロー

```
┌─────────┐         ┌─────────────┐         ┌─────────┐
│  店舗   │         │  サーバー   │         │ 利用者  │
└────┬────┘         └──────┬──────┘         └────┬────┘
     │                      │                      │
     │ ① QRコード掲示       │                      │
     │ ─────────────────────────────────────────▶ │
     │                      │                      │
     │                      │ ② QR読取・ログイン   │
     │                      │ ◀──────────────────│
     │                      │                      │
     │                      │ ③ 利用者QR表示       │
     │ ◀─────────────────────────────────────────│
     │                      │                      │
     │ ④ QR読取・金額入力    │                      │
     │ ─────────────────────▶                      │
     │                      │                      │
     │                      │ ⑤ 電子領収書配信     │
     │                      │ ─────────────────────▶
```

**注意:** ステップ③④のフロー（利用者QR表示→店舗読取）に特許リスクの可能性があり、設計変更を検討中。詳細は「6. 特許関連の重要知見」を参照。

---

## 4. 技術スタック（想定）

| レイヤー | 技術 | 理由 |
|----------|------|------|
| バックエンド | **Rust / Axum** | 高性能、型安全、オーナーの専門領域 |
| データベース | **PostgreSQL** | 電帳法対応の履歴管理、堅牢性 |
| 認証 | **OAuth2 / WebAuthn** | セキュリティ、oauth2-passkey活用可能 |
| インフラ | **GCP / Kubernetes** | スケーラビリティ、既存知見 |
| API | REST / GraphQL | POSベンダー連携 |
| フロントエンド | 未定 | 検討中 |

### 4.1 活用可能な既存資産
- **oauth2-passkey**: オーナーが開発したRust認証ライブラリ（crates.io公開済み）
- **oauth2-passkey-axum**: Axum統合版
- GCP/Terraform/Kubernetesの運用経験

---

## 5. 開発ロードマップ

### Phase 1: MVP（3ヶ月）
- [ ] 店舗向けAPI（領収書データ送信、QRコード生成）
- [ ] 利用者向けWebアプリ（QR読取、領収書閲覧・保存）
- [ ] 管理画面（店舗管理、発行履歴）

### Phase 2: 電帳法対応（2ヶ月）
- [ ] 訂正削除履歴機能（方法B）
- [ ] 検索機能（日付・金額・取引先）
- [ ] PDF/CSV出力

### Phase 3: 会計ソフト連携（2ヶ月）
- [ ] freee連携（API）
- [ ] マネーフォワード連携（API）
- [ ] 弥生連携（CSV）

### Phase 4: 拡張機能（継続）
- [ ] 認定タイムスタンプ（方法A）
- [ ] インボイス対応
- [ ] POSレジ連携（Square、スマレジ）

---

## 6. 特許関連の重要知見

### 6.1 調査済み特許

| 特許 | 権利者 | 内容 | 本システムへの影響 |
|------|--------|------|-------------------|
| **6598936** | 東芝テック | 電子レシートのフラグ表示機能 | **低リスク**（フラグ表示を実装しなければ非該当） |
| **6618585** | 東芝テック | 返品処理連動 | 要確認（請求項未精査） |
| **5503795** | freee | 勘定科目自動判定（キーワードテーブル） | **回避可能**（実装しない） |

### 6.2 特許6598936の結論（本セッションで詳細解析済み）

**全14請求項を解析した結果:**
- 全請求項が「**フラグによる表示態様変更**」を必須構成要件としている
- 値引き商品/ポイント期限/操作ミスの強調表示機能
- **これらを実装しなければ本特許は非該当**
- QRコードフローとは無関係

### 6.3 設計上の制約（DO / DON'T）

**✅ DO（実装してよい）:**
- 電子領収書データの保存・配信
- 取引明細の均一な表示
- 領収書のダウンロード・印刷機能
- 経費精算システムへのデータ連携

**❌ DON'T（実装してはいけない）:**
- 特定項目（値引き等）の文字色・背景色変更による強調表示
- ポイント機能（特に有効期限管理と強調表示）
- 操作ミス箇所の強調表示
- 勘定科目の自動判定（キーワードテーブル方式）

**⚠️ CAUTION（要注意・追加調査必要）:**
- 「利用者QR表示→店舗読取」フローの特許状況（6598936とは別の特許が存在する可能性）
- Airレジ・スマレジの特許状況（店舗QR表示方式）

### 6.4 残課題（特許関連）
- [ ] QRコードフロー関連の東芝テック別特許調査
- [ ] 特許6618585の請求項詳細確認
- [ ] Airレジ・スマレジの特許調査
- [ ] 弁理士への正式相談

---

## 7. 競合分析サマリー

| 競合 | ポジション | 本システムとの差異 |
|------|-----------|-------------------|
| **スマートレシート（東芝テック）** | 電子レシート、家計管理向け | **領収書は対象外**、経費精算機能なし |
| **楽楽精算、TOKIUM等** | 経費精算、OCR読取 | OCR（誤認識リスク）vs 店舗発行データ（100%正確） |
| **freee、マネーフォワード** | 会計ソフト | 領収書発行機能なし、連携先として想定 |

**差別化ポイント:**
1. OCR不要、100%正確なデータ
2. 経費精算特化（スマートレシートとは別市場）
3. 店舗・利用者双方で電帳法対応
4. 印紙税削減メリット

---

## 8. 関連ドキュメント一覧

| ファイル名 | 内容 | 重要度 |
|-----------|------|--------|
| `receipt-system-idea.md` | ビジネスアイデア包括まとめ | ⭐⭐⭐ |
| `receipt-system-business-plan.md` | ビジネスプラン | ⭐⭐⭐ |
| `patent-analysis-revised.md` | 特許侵害リスク分析（改訂版） | ⭐⭐⭐ |
| `user-prompts-history.md` | プロンプト履歴（思考プロセス） | ⭐⭐ |
| `patent-infringement-risk-analysis.md` | 特許分析（初版） | ⭐⭐ |
| `patent-research-report.md` | 特許調査レポート | ⭐⭐ |

---

## 9. 次のアクション（優先順）

### 即時（1週間以内）
1. [ ] プロジェクトリポジトリ作成
2. [ ] QRコードフロー関連の追加特許調査
3. [ ] 弁理士相談の予約

### 短期（1ヶ月以内）
4. [ ] API仕様設計（OpenAPI）
5. [ ] データベーススキーマ設計
6. [ ] MVP開発開始

### 中期（3ヶ月以内）
7. [ ] プロトタイプ完成
8. [ ] POSベンダーへのヒアリング
9. [ ] パイロット店舗での実証実験

---

## 10. 技術的な検討事項

### 10.1 QRコード設計
```
店舗QR: https://receipt.example.com/store/{store_token}
利用者QR: https://receipt.example.com/user/{one_time_token}

- one_time_token: 有効期限付き（数分〜24時間）
- 1回の読取で紐付け、紐付け後は無効化
```

### 10.2 電子帳簿保存法対応
| 要件 | 対応方法 |
|------|----------|
| 真実性の確保 | 方法B: 訂正削除履歴の自動記録 |
| 可視性の確保 | 検索機能（日付・金額・取引先） |
| 将来対応 | 方法A: 認定タイムスタンプ追加 |

### 10.3 データモデル（概念）
```
Store (店舗)
├── id
├── name
├── address
├── invoice_number (適格請求書発行事業者番号)
└── ...

User (利用者)
├── id
├── name
├── company_name
└── ...

Receipt (領収書)
├── id
├── store_id
├── user_id
├── amount
├── description
├── issued_at
├── created_at
└── ...

ReceiptHistory (訂正削除履歴)
├── id
├── receipt_id
├── action (create/update/delete)
├── changed_at
├── changed_by
└── previous_data (JSON)
```

---

## 11. オーナー情報

**Kimitoshi**
- Cluster Computing Corporation CEO
- PhD in Information Science (国立情報学研究所)
- 専門: Rust開発、認証システム（OAuth2/WebAuthn）、インフラ（GCP/K8s）
- 公開ライブラリ: oauth2-passkey, oauth2-passkey-axum (crates.io)

---

## 12. プロジェクト命名候補（未決定）

- e-Receipt
- デジタル領収書
- Receipt Direct
- その他検討中

---

*このドキュメントはClaude Codeでの開発継続のために作成されました。*
*最終更新: 2026年2月4日*
