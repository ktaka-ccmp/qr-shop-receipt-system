# 回避すべき実装一覧

**作成日:** 2026年2月5日
**対象:** QR Shop Receipt System（電子領収書発行システム）

---

## 概要

本ドキュメントは、特許侵害リスクを回避するために**実装してはいけない機能**を明確化したものである。開発チームは本リストを参照し、設計・実装時に該当機能を含めないよう注意すること。

---

## 1. 絶対回避（実装禁止）

### 1.1 ハイライト表示機能

**関連特許:** 東芝テック 特許6598936（有効期限: 2034年9月）

| 禁止事項 | 詳細 |
|---------|------|
| 特定項目のハイライト表示 | 電子領収書内の特定の商品や金額を色・背景で強調表示 |
| フラグベースの表示変更 | データにフラグを付与し、それに基づいて表示態様を変更 |
| ポイント有効期限の強調 | ポイントの有効期限を色や背景の変更で強調表示 |
| キャンペーン商品の強調 | キャンペーン対象商品を視覚的に強調 |

**具体的な禁止実装例:**

```javascript
// ❌ 禁止: フラグに基づくハイライト表示
if (item.flag === 'highlight') {
  item.style.backgroundColor = 'yellow';
}

// ❌ 禁止: 特定条件での色変更
if (item.isExpiringSoon) {
  item.style.color = 'red';
}
```

**許可される実装:**

```javascript
// ✅ 許可: 統一フォーマットでの表示（強調なし）
items.forEach(item => {
  display(item.name, item.price);  // 全項目同一の表示態様
});
```

---

### 1.2 キーワード対応テーブルによる勘定科目自動判定

**関連特許:** freee 特許5503795（有効期限: 2033年11月頃）

| 禁止事項 | 詳細 |
|---------|------|
| キーワード対応テーブル | 取引内容のキーワードと勘定科目を対応付けるテーブルの使用 |
| キーワード抽出と自動仕訳 | 取引内容からキーワードを抽出し、自動的に勘定科目を確定 |
| 優先ルールの適用 | 複数キーワードが含まれる場合の優先順位決定ロジック |

**具体的な禁止実装例:**

```javascript
// ❌ 禁止: キーワード対応テーブルによる自動仕訳
const keywordTable = {
  'JR': '旅費交通費',
  'タクシー': '旅費交通費',
  'モロゾフ': '接待費',
  'スターバックス': '会議費'
};

function autoClassify(description) {
  for (const [keyword, account] of Object.entries(keywordTable)) {
    if (description.includes(keyword)) {
      return account;  // ❌ 自動的に勘定科目を確定
    }
  }
}
```

**許可される実装:**

```javascript
// ✅ 許可: 勘定科目を空欄のまま出力
function exportReceipt(receipt) {
  return {
    date: receipt.date,
    amount: receipt.amount,
    description: receipt.description,
    account: null  // ユーザーが会計ソフトで入力
  };
}

// ✅ 許可: 機械学習による推定（判例で非侵害確認済み）
function predictAccount(receipt, mlModel) {
  return mlModel.predict(receipt);  // 統計的推測
}

// ✅ 許可: 候補提示のみ（ユーザーが確定）
function suggestAccounts(receipt) {
  return ['会議費', '交際費', '福利厚生費'];  // 選択肢として提示
}
```

---

## 2. 高リスク回避（実装非推奨）

### 2.1 返品連動の電子レシート自動訂正

**関連特許:** 東芝テック 特許6618585（有効期限: 2033年9月）

| 非推奨事項 | 詳細 |
|-----------|------|
| 返品時の自動訂正レシート生成 | 返品商品コード入力で訂正電子レシートを自動生成 |
| 返品レシートの自動送信 | 訂正後のレシートデータを利用者端末に自動送信 |

**代替実装案:**
- 返品時は新規の返品レシートとして発行（訂正ではなく新規発行）
- 利用者が手動で再ダウンロードする方式

---

### 2.2 QRコード認証フロー（CPM方式）

**注記:** 当初「東芝テック関連特許」としていましたが、東芝テック特許6598936の請求項を再確認した結果、**QRコードのフロー自体は特許の核心的構成要素ではない**ことが判明しました。特許6598936の核心は「フラグに基づく表示態様変更」であり、CPM/MPMの方式選択とは直接関係ありません。

**現状:** 調査未完了（他社特許の可能性は排除できない）

| 検討事項 | 詳細 |
|---------|------|
| 利用者QR表示→店舗読取（CPM） | 東芝テック特許6598936とは無関係。ただし他社特許の調査は未完了 |
| 店舗QR表示→利用者読取（MPM） | QRコード決済で広く採用されている方式。公知例多数 |

**推奨:**
- **MPM方式**を採用（公知例が多く、リスクが相対的に低い）
- CPM方式を採用する場合は、Airレジ/スマレジ等の特許調査を完了させてから判断

---

## 3. 注意が必要な実装

### 3.1 ポイント機能

| 注意事項 | 対応 |
|---------|------|
| ポイント有効期限の表示 | 通常のテキスト表示は可、ハイライト表示は禁止 |
| ポイント残高表示 | 通常のテキスト表示は可 |

### 3.2 会計ソフト連携

| 注意事項 | 対応 |
|---------|------|
| データエクスポート | CSV/JSONでの出力は安全 |
| API連携 | データ送信のみで勘定科目判定は会計ソフト側 |
| 勘定科目の事前設定 | ユーザーによる手動設定は安全 |

---

## 4. 設計チェックリスト

### 4.1 画面設計時

- [ ] 特定の項目をハイライト（色・背景変更）する機能がないか
- [ ] フラグに基づく表示態様変更がないか
- [ ] ポイント有効期限を視覚的に強調していないか

### 4.2 データモデル設計時

- [ ] キーワード対応テーブル（勘定科目用）を含んでいないか
- [ ] 表示態様変更用のフラグフィールドがないか

### 4.3 API設計時

- [ ] 自動仕訳APIが含まれていないか（機械学習方式を除く）
- [ ] 返品時の自動訂正APIが含まれていないか

### 4.4 認証フロー設計時

- [ ] MPM方式（店舗QR表示→利用者読取）を採用しているか（推奨）
- [ ] CPM方式を採用する場合、追加の特許調査を完了しているか

---

## 5. 安全な実装パターン

### 5.1 電子領収書表示

```html
<!-- ✅ 安全: 統一フォーマットでの表示 -->
<div class="receipt">
  <div class="receipt-item">商品A: ¥1,000</div>
  <div class="receipt-item">商品B: ¥2,000</div>
  <div class="receipt-total">合計: ¥3,000</div>
</div>
```

### 5.2 会計ソフト連携

```json
// ✅ 安全: 勘定科目なしでのデータエクスポート
{
  "date": "2026-02-05",
  "store": "サンプル店舗",
  "amount": 3000,
  "description": "文房具",
  "account": null  // 会計ソフト側で入力
}
```

### 5.3 QRコード認証フロー

```
✅ 推奨フロー:
[店舗] QRコード表示（店舗ID + トランザクションID）
    ↓
[利用者] スマホでQRコード読取
    ↓
[利用者] Webアプリでログイン認証
    ↓
[サーバー] 領収書データを利用者アカウントに紐付け
```

---

## 6. 違反時の対応

### 6.1 設計レビューでの発見時

1. 該当機能の設計を削除または修正
2. 代替実装案を検討
3. 必要に応じて弁理士に相談

### 6.2 実装後の発見時

1. 該当機能を即時無効化
2. リリース前であればコード削除
3. リリース後であれば緊急パッチ適用

---

## 参考資料

- [summary.md](summary.md) - 調査結果サマリー
- [reports/toshiba-tec.md](reports/toshiba-tec.md) - 東芝テック特許詳細
- [reports/freee.md](reports/freee.md) - freee特許詳細

---

**注意事項:**
- 本リストは予備的な調査結果に基づいています
- 最終的な判断は弁理士との相談に基づいて行ってください
- 新機能追加時は本リストを必ず確認してください
